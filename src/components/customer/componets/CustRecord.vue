<template>
  <div ref="chatContainerRef" class="chat-message-log">
    <div class="message" v-for="(message, index) in store.userMessage" :key="index"
      :class="{ 'receiver-message': message.receiver, 'sender-message': !message.receiver }">
      <img v-if="message.receiver" class="avatar" src="../../../assets/img/customerImg/customer-img.png"
        :alt="message.altText" />
      <svg v-else class="avatar-user" width="8" height="8" viewBox="0 0 8 8" fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <circle cx="4" cy="4" r="4" fill="#A9E162" style="fill: var(--app-color-theme)" />
      </svg>

      <div class="message-content">
        <div :class="{
          'message-text': true,
          'message-text-left': message.receiver,
          'message-text-right': !message.receiver
        }">
          {{ message.content }}
        </div>
      </div>
    </div>

  </div>
  <div class="chat-phone">
    <svg width="198" height="12" viewBox="0 0 198 12" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M5.278 11.196C2.716 11.196 0.812 9.208 0.812 5.876C0.812 2.572 2.758 0.555999 5.362 0.555999C6.608 0.555999 7.574 1.158 8.176 1.816L7.462 2.656C6.93 2.082 6.244 1.69 5.376 1.69C3.43 1.69 2.142 3.286 2.142 5.848C2.142 8.438 3.374 10.048 5.334 10.048C6.3 10.048 7.056 9.628 7.714 8.9L8.414 9.712C7.602 10.664 6.608 11.196 5.278 11.196ZM13.7297 11.196C11.8537 11.196 10.2017 9.726 10.2017 7.22C10.2017 4.672 11.8537 3.216 13.7297 3.216C15.5917 3.216 17.2437 4.672 17.2437 7.22C17.2437 9.726 15.5917 11.196 13.7297 11.196ZM13.7297 10.132C15.0457 10.132 15.9277 8.956 15.9277 7.22C15.9277 5.456 15.0457 4.28 13.7297 4.28C12.3997 4.28 11.5177 5.456 11.5177 7.22C11.5177 8.956 12.3997 10.132 13.7297 10.132ZM19.826 11V3.398H20.862L20.988 4.504H21.03C21.744 3.79 22.528 3.216 23.578 3.216C25.174 3.216 25.902 4.252 25.902 6.184V11H24.614V6.352C24.614 4.924 24.18 4.322 23.172 4.322C22.402 4.322 21.856 4.728 21.1 5.484V11H19.826ZM31.3109 11.196C29.6869 11.196 29.1549 10.174 29.1549 8.662V4.434H28.0209V3.482L29.2109 3.398L29.3509 1.256H30.4289V3.398H32.4869V4.434H30.4289V8.69C30.4289 9.614 30.7229 10.16 31.6049 10.16C31.8709 10.16 32.2209 10.048 32.4589 9.95L32.7109 10.902C32.2909 11.056 31.7869 11.196 31.3109 11.196ZM36.1354 11.196C34.8614 11.196 33.9094 10.398 33.9094 9.026C33.9094 7.374 35.3374 6.548 38.5714 6.184C38.5714 5.204 38.2634 4.266 37.0174 4.266C36.1214 4.266 35.3234 4.686 34.7354 5.092L34.2314 4.196C34.9314 3.748 35.9954 3.216 37.2134 3.216C39.0754 3.216 39.8594 4.448 39.8594 6.338V11H38.8094L38.6974 10.104H38.6414C37.9274 10.706 37.0734 11.196 36.1354 11.196ZM36.4854 10.16C37.2274 10.16 37.8434 9.81 38.5714 9.152V7.038C36.0094 7.332 35.1554 7.962 35.1554 8.942C35.1554 9.81 35.7434 10.16 36.4854 10.16ZM45.8161 11.196C43.8001 11.196 42.2601 9.726 42.2601 7.22C42.2601 4.672 43.9681 3.216 45.9141 3.216C46.9081 3.216 47.6081 3.622 48.1401 4.112L47.4961 4.952C47.0481 4.546 46.5721 4.28 45.9841 4.28C44.5841 4.28 43.5761 5.456 43.5761 7.22C43.5761 8.956 44.5421 10.132 45.9421 10.132C46.6281 10.132 47.2581 9.796 47.7341 9.376L48.2801 10.23C47.6081 10.832 46.7261 11.196 45.8161 11.196ZM52.7194 11.196C51.0954 11.196 50.5634 10.174 50.5634 8.662V4.434H49.4294V3.482L50.6194 3.398L50.7594 1.256H51.8374V3.398H53.8954V4.434H51.8374V8.69C51.8374 9.614 52.1314 10.16 53.0134 10.16C53.2794 10.16 53.6294 10.048 53.8674 9.95L54.1194 10.902C53.6994 11.056 53.1954 11.196 52.7194 11.196ZM62.0796 11.196C60.4836 11.196 59.7556 10.16 59.7556 8.214V3.398H61.0296V8.06C61.0296 9.474 61.4636 10.076 62.4716 10.076C63.2416 10.076 63.8016 9.698 64.5156 8.802V3.398H65.7896V11H64.7396L64.6276 9.81H64.5996C63.8856 10.636 63.1296 11.196 62.0796 11.196ZM70.9195 11.196C69.8415 11.196 68.7915 10.734 68.0775 10.146L68.7075 9.292C69.3655 9.824 70.0375 10.202 70.9475 10.202C71.9555 10.202 72.4595 9.67 72.4595 8.998C72.4595 8.228 71.5495 7.878 70.7095 7.57C69.6595 7.164 68.4975 6.66 68.4975 5.358C68.4975 4.154 69.4635 3.216 71.1155 3.216C72.0535 3.216 72.8935 3.594 73.4815 4.07L72.8655 4.882C72.3475 4.504 71.8015 4.21 71.1295 4.21C70.1635 4.21 69.7295 4.714 69.7295 5.302C69.7295 6.03 70.4995 6.31 71.3675 6.618C72.4735 7.038 73.6775 7.486 73.6775 8.928C73.6775 10.174 72.7115 11.196 70.9195 11.196ZM76.6843 5.54C76.1803 5.54 75.7743 5.148 75.7743 4.574C75.7743 3.986 76.1803 3.594 76.6843 3.594C77.2023 3.594 77.6223 3.986 77.6223 4.574C77.6223 5.148 77.2023 5.54 76.6843 5.54ZM76.6843 11.196C76.1803 11.196 75.7743 10.79 75.7743 10.216C75.7743 9.628 76.1803 9.236 76.6843 9.236C77.2023 9.236 77.6223 9.628 77.6223 10.216C77.6223 10.79 77.2023 11.196 76.6843 11.196ZM86.2597 9.376V6.324H83.4177V5.372H86.2597V2.306H87.2957V5.372H90.1377V6.324H87.2957V9.376H86.2597ZM92.4573 11V9.936H94.7393V2.586H92.9053V1.76C93.8293 1.592 94.4873 1.354 95.0333 1.032H96.0133V9.936H98.0853V11H92.4573ZM100.195 7.584V6.604H103.779V7.584H100.195ZM105.58 11V10.258C108.59 7.262 110.27 5.456 110.27 3.818C110.27 2.684 109.668 1.872 108.394 1.872C107.554 1.872 106.826 2.404 106.252 3.076L105.51 2.348C106.35 1.438 107.246 0.85 108.548 0.85C110.382 0.85 111.53 1.998 111.53 3.776C111.53 5.652 109.808 7.514 107.442 10.006C107.974 9.95 108.604 9.908 109.122 9.908H112.02V11H105.58ZM113.906 11V10.258C116.916 7.262 118.596 5.456 118.596 3.818C118.596 2.684 117.994 1.872 116.72 1.872C115.88 1.872 115.152 2.404 114.578 3.076L113.836 2.348C114.676 1.438 115.572 0.85 116.874 0.85C118.708 0.85 119.856 1.998 119.856 3.776C119.856 5.652 118.134 7.514 115.768 10.006C116.3 9.95 116.93 9.908 117.448 9.908H120.346V11H113.906ZM122.232 11V10.258C125.242 7.262 126.922 5.456 126.922 3.818C126.922 2.684 126.32 1.872 125.046 1.872C124.206 1.872 123.478 2.404 122.904 3.076L122.162 2.348C123.002 1.438 123.898 0.85 125.2 0.85C127.034 0.85 128.182 1.998 128.182 3.776C128.182 5.652 126.46 7.514 124.094 10.006C124.626 9.95 125.256 9.908 125.774 9.908H128.672V11H122.232ZM130.585 7.584V6.604H134.169V7.584H130.585ZM139.009 11.196C137.413 11.196 136.433 10.524 135.733 9.824L136.377 8.984C136.951 9.586 137.707 10.132 138.883 10.132C140.101 10.132 141.067 9.25 141.067 7.85C141.067 6.478 140.227 5.652 138.953 5.652C138.267 5.652 137.833 5.876 137.245 6.268L136.559 5.834L136.881 1.032H141.879V2.124H138.001L137.735 5.092C138.197 4.84 138.659 4.686 139.275 4.686C140.983 4.686 142.369 5.652 142.369 7.808C142.369 9.978 140.731 11.196 139.009 11.196ZM147.334 11.196C145.738 11.196 144.758 10.524 144.058 9.824L144.702 8.984C145.276 9.586 146.032 10.132 147.208 10.132C148.426 10.132 149.392 9.25 149.392 7.85C149.392 6.478 148.552 5.652 147.278 5.652C146.592 5.652 146.158 5.876 145.57 6.268L144.884 5.834L145.206 1.032H150.204V2.124H146.326L146.06 5.092C146.522 4.84 146.984 4.686 147.6 4.686C149.308 4.686 150.694 5.652 150.694 7.808C150.694 9.978 149.056 11.196 147.334 11.196ZM155.66 11.196C154.064 11.196 153.084 10.524 152.384 9.824L153.028 8.984C153.602 9.586 154.358 10.132 155.534 10.132C156.752 10.132 157.718 9.25 157.718 7.85C157.718 6.478 156.878 5.652 155.604 5.652C154.918 5.652 154.484 5.876 153.896 6.268L153.21 5.834L153.532 1.032H158.53V2.124H154.652L154.386 5.092C154.848 4.84 155.31 4.686 155.926 4.686C157.634 4.686 159.02 5.652 159.02 7.808C159.02 9.978 157.382 11.196 155.66 11.196ZM160.976 7.584V6.604H164.56V7.584H160.976ZM169.637 11.196C167.635 11.196 166.431 9.334 166.431 5.988C166.431 2.642 167.635 0.85 169.637 0.85C171.611 0.85 172.815 2.642 172.815 5.988C172.815 9.334 171.611 11.196 169.637 11.196ZM169.637 10.16C170.799 10.16 171.583 8.914 171.583 5.988C171.583 3.048 170.799 1.872 169.637 1.872C168.461 1.872 167.663 3.048 167.663 5.988C167.663 8.914 168.461 10.16 169.637 10.16ZM177.963 11.196C175.961 11.196 174.757 9.334 174.757 5.988C174.757 2.642 175.961 0.85 177.963 0.85C179.937 0.85 181.141 2.642 181.141 5.988C181.141 9.334 179.937 11.196 177.963 11.196ZM177.963 10.16C179.125 10.16 179.909 8.914 179.909 5.988C179.909 3.048 179.125 1.872 177.963 1.872C176.787 1.872 175.989 3.048 175.989 5.988C175.989 8.914 176.787 10.16 177.963 10.16ZM186.288 11.196C184.286 11.196 183.082 9.334 183.082 5.988C183.082 2.642 184.286 0.85 186.288 0.85C188.262 0.85 189.466 2.642 189.466 5.988C189.466 9.334 188.262 11.196 186.288 11.196ZM186.288 10.16C187.45 10.16 188.234 8.914 188.234 5.988C188.234 3.048 187.45 1.872 186.288 1.872C185.112 1.872 184.314 3.048 184.314 5.988C184.314 8.914 185.112 10.16 186.288 10.16ZM194.614 11.196C192.612 11.196 191.408 9.334 191.408 5.988C191.408 2.642 192.612 0.85 194.614 0.85C196.588 0.85 197.792 2.642 197.792 5.988C197.792 9.334 196.588 11.196 194.614 11.196ZM194.614 10.16C195.776 10.16 196.56 8.914 196.56 5.988C196.56 3.048 195.776 1.872 194.614 1.872C193.438 1.872 192.64 3.048 192.64 5.988C192.64 8.914 193.438 10.16 194.614 10.16Z"
        fill="#929292" />
    </svg>


  </div>
</template>

<script setup>
import { useMessageStore } from '@/store/useMessageStore'
import { nextTick, ref, watchEffect } from 'vue';
import { socket } from '@/socket/socketIo'
const store = useMessageStore()
//聊天滚动
const chatContainerRef = ref(null)
const scrollToBottom = () => {
  nextTick(() => {
    if (chatContainerRef.value) {
      chatContainerRef.value.scrollTop = chatContainerRef.value.scrollHeight
    }
  })

}
watchEffect(() => {
  if (store.userMessage.length) {
    scrollToBottom()
  }
})
//接收消息WhatsApp发送的消息
socket.on('private message', (msg) => {
  store.userMessage.push({
    id: store.userMessage.length + 1,
    content: msg,
    receiver: true
  })
})
</script>

<style lang="scss" scoped>
.message {
  display: flex;
  align-items: flex-start;
  margin: 0.625em;
}

.avatar {
  width: 4.125em;
  height: 4.125em;
  margin-right: 0.5em;
  margin-left: 0.5em;
}

.message-text {
  padding: 1.5em;
  background-color: #e1e1e1;
  font-size: 0.9375em;
  /*white-space: pre-wrap;*/
  word-wrap: break-word;
  letter-spacing: 1px;
}

.message-content {
  max-width: 80%;
}

.message-text-right {
  border-radius: 1.5em 0em 1.5em 1.5em;
  background-color: #ffffff;
  color: #474747;
}

.message-text-left {
  border-radius: 0 1.5em 1.5em 1.5em;
  background-color: #33bcea;
  color: #ffffff;
}

.receiver-message {
  justify-content: flex-start;
}

.sender-message {
  display: flex;
  justify-content: flex-start;
  flex-direction: row-reverse;
}

.sender-message:nth-child(1) {
  margin-top: 2em;
}

.chat-message-log {
  display: flex;
  flex: 1;
  max-height: 39.5em;
  flex-direction: column;
  overflow-y: scroll;
}

.chat-message-log::-webkit-scrollbar {
  width: 0.5em !important;
  /* 设置滚动条宽度 */
}

.chat-message-log::-webkit-scrollbar-thumb {
  background-color: #d9d9d9 !important;
  /* 设置滚动条滑块的颜色 */
  border-radius: 4px !important;
  /* 设置滚动条滑块的圆角 */
}

.chat-message-log::-webkit-scrollbar-thumb:hover {
  background-color: #80a5cc !important;
  /* 设置滚动条滑块在悬停时的颜色 */
}

.chat-phone {
  height: 2em;
  justify-self: center;
  align-self: center;
}

.avatar-user {
  width: 8px;
  height: 8px;
  margin-left: 8px;
}
</style>
